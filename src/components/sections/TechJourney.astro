---
import type { WorkExperience } from "../../types";
import TimelineCard from "../common/TimelineCard.astro";

export interface Props {
  journeyTitle: string;
  journeyDesc: string;
  workExperience: WorkExperience[];
  achievements: Record<string, string[]>;
}

const { journeyTitle, journeyDesc, workExperience, achievements } = Astro.props;
---

<section class="py-20 bg-muted">
  <div class="max-w-6xl mx-auto px-6">
    <div class="text-center mb-16 animate-fade-in-up">
      <h2
        class="text-3xl lg:text-4xl font-bold text-primary mb-4"
        id="journeyTitle"
      >
        {journeyTitle}
      </h2>
      <p
        class="text-xl text-muted-foreground max-w-2xl mx-auto"
        id="journeyDesc"
      >
        {journeyDesc}
      </p>
    </div>

    <div class="relative">
      <!-- Timeline Line - Left aligned on mobile, centered on desktop -->
      <div
        class="absolute left-4 lg:left-1/2 lg:transform lg:-translate-x-1/2 w-0.5 lg:w-1 h-full bg-primary/30"
      >
      </div>

      <div class="space-y-8 lg:space-y-16" id="journeyTimeline">
        {
          workExperience.map((job, i) => {
            const year = job.period.split(' - ')[0].split(' ').pop() || job.period;
            const jobAchievements = achievements[job.company] || [];
            const description = jobAchievements.length > 0
              ? jobAchievements.join(' â€¢ ')
              : job.position;
            
            return (
              <div
                class="animate-fade-in-up relative"
                style={`animation-delay: ${i * 0.1}s`}
              >
                {/* Mobile Layout - Single column with left-aligned dots */}
                <div class="lg:hidden flex gap-4 items-start">
                  {/* Timeline Dot - Mobile */}
                  <div class="flex-shrink-0 flex justify-center items-center relative z-10 pt-2">
                    <div class="w-8 h-8 bg-primary rounded-full border-4 border-background shadow-lg ring-4 ring-primary/30" />
                  </div>
                  
                  {/* Card - Mobile */}
                  <div class="flex-1">
                    <TimelineCard
                      year={year}
                      title={job.position}
                      description={description}
                      tech={job.technologies}
                      align="left"
                    />
                  </div>
                </div>

                {/* Desktop Layout - Alternating sides */}
                <div class="hidden lg:grid lg:grid-cols-[1fr_auto_1fr] gap-8 items-center">
                  {i % 2 === 0 ? (
                    <>
                      {/* Left Side */}
                      <TimelineCard
                        year={year}
                        title={job.position}
                        description={description}
                        tech={job.technologies}
                        align="left"
                      />

                      {/* Timeline Dot - Desktop */}
                      <div class="flex justify-center items-center relative z-10">
                        <div class="w-6 h-6 bg-primary rounded-full border-[5px] border-background shadow-xl ring-4 ring-primary/20" />
                      </div>

                      {/* Empty Right Side */}
                      <div />
                    </>
                  ) : (
                    <>
                      {/* Empty Left Side */}
                      <div />

                      {/* Timeline Dot - Desktop */}
                      <div class="flex justify-center items-center relative z-10">
                        <div class="w-6 h-6 bg-primary rounded-full border-[5px] border-background shadow-xl ring-4 ring-primary/20" />
                      </div>

                      {/* Right Side */}
                      <TimelineCard
                        year={year}
                        title={job.position}
                        description={description}
                        tech={job.technologies}
                        align="right"
                      />
                    </>
                  )}
                </div>
              </div>
            );
          })
        }
      </div>
    </div>
  </div>
</section>
